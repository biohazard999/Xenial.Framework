using System;
using System.Linq;

using DevExpress.ExpressApp.Model;
using DevExpress.ExpressApp.Model.Core;
using DevExpress.ExpressApp.Model.NodeGenerators;

using Xenial.Framework.Base;

#pragma warning disable CA1309 //Use ordinal string comparison -> By Design
#pragma warning disable CA1307 //Use ordinal string comparison -> By Design

namespace Xenial.Framework.Model.GeneratorUpdaters
{
    /// <summary>
    /// Class ModelViewsGenerateNoViewsUpdater. This class cannot be inherited.
    /// Implements the <see cref="ModelNodesGeneratorUpdater{ModelViewsNodesGenerator}" />
    /// </summary>
    /// <seealso cref="ModelNodesGeneratorUpdater{ModelViewsNodesGenerator}" />
    /// <autogeneratedoc />
    [XenialCheckLicence]
    public sealed partial class ModelViewsGenerateNoViewsUpdater : ModelNodesGeneratorUpdater<ModelViewsNodesGenerator>
    {
        /// <summary>
        /// Updates the Application Model node content generated by the Nodes Generator, specified by the <see cref="T:DevExpress.ExpressApp.Model.ModelNodesGeneratorUpdater`1" /> class' type parameter.
        /// </summary>
        /// <param name="node">A ModelNode Application Model node to be updated.</param>
        /// <autogeneratedoc />
        public override void UpdateNode(ModelNode node)
        {
            if (node is IModelViews views)
            {
                foreach (var view in views.OfType<IModelObjectView>())
                {
                    foreach (var attribute in view.ModelClass.TypeInfo.FindAttributes<GenerateNoViewAttribute>())
                    {
                        if (view.Id.Equals(attribute.ViewId))
                        {
                            view.Remove();
                        }
                    }

                    if (view.ModelClass.TypeInfo.FindAttribute<GenerateNoDetailViewAttribute>() != null)
                    {
                        if (view is IModelDetailView)
                        {
                            if (ModelNodeIdHelper.GetDetailViewId(view.ModelClass.TypeInfo.Type).Equals(view.Id))
                            {
                                view.Remove();
                            }
                        }
                    }

                    if (view.ModelClass.TypeInfo.FindAttribute<GenerateNoListViewAttribute>() != null)
                    {
                        if (view is IModelListView)
                        {
                            if (ModelNodeIdHelper.GetListViewId(view.ModelClass.TypeInfo.Type).Equals(view.Id))
                            {
                                view.Remove();
                            }
                        }
                    }

                    if (view.ModelClass.TypeInfo.FindAttribute<GenerateNoLookupListViewAttribute>() != null)
                    {
                        if (view is IModelListView)
                        {
                            if (ModelNodeIdHelper.GetLookupListViewId(view.ModelClass.TypeInfo.Type).Equals(view.Id))
                            {
                                view.Remove();
                            }
                        }
                    }
                }
            }
        }
    }
}
