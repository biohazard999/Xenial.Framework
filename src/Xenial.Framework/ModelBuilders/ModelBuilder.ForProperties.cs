using System;
using System.Collections.Generic;
using System.Linq.Expressions;
using System.Text;

namespace Xenial.Framework.ModelBuilders
{
    public partial class ModelBuilder<TClassType>
    {
        /// <summary>
        /// Fors the properties.
        /// </summary>
        /// <param name="propertyExpressions">The property expressions.</param>
        /// <returns>Xenial.Framework.ModelBuilders.MultiplePropertyBuilder&lt;object?, TClassType&gt;.</returns>
        /// <autogeneratedoc />
        public MultiplePropertyBuilder<object?, TClassType> ForProperties(params Expression<Func<TClassType, object?>>[] propertyExpressions)
        {
            var propertyBuilderList = new List<IPropertyBuilder<object?, TClassType>>();

            foreach (var propertyExpression in propertyExpressions)
            {
                _ = propertyExpression ?? throw new ArgumentNullException(nameof(propertyExpressions));

                var propertyName = ExpressionHelper.Property(propertyExpression);
                if (propertyName is not null)
                {
                    var memberInfo = TypeInfo.FindMember(propertyName);
                    if (memberInfo is not null)
                    {
                        var propertyBuilder = PropertyBuilder.PropertyBuilderFor<object?, TClassType>(memberInfo);

                        Add(propertyBuilder);

                        propertyBuilderList.Add(propertyBuilder);
                    }
                    else
                    {
                        throw new InvalidOperationException($"Could not create PropertyBuilder for '{TypeInfo}'.{propertyName} ");
                    }
                }
                else
                {
                    throw new InvalidOperationException($"Could not create PropertyBuilder for '{TypeInfo}'.{propertyExpression} ");
                }
            }

            return new MultiplePropertyBuilder<object?, TClassType>(propertyBuilderList);
        }

        /// <summary>
        /// Fors the properties.
        /// </summary>
        /// <typeparam name="TPropertyType">The type of the t property type.</typeparam>
        /// <param name="propertyExpressions">The property expressions.</param>
        /// <returns>Xenial.Framework.ModelBuilders.MultiplePropertyBuilder&lt;TPropertyType?, TClassType&gt;.</returns>
        /// <autogeneratedoc />
        public MultiplePropertyBuilder<TPropertyType?, TClassType> ForProperties<TPropertyType>(params Expression<Func<TClassType, TPropertyType?>>[] propertyExpressions)
        {
            var propertyBuilderList = new List<IPropertyBuilder<TPropertyType?, TClassType>>();

            foreach (var propertyExpression in propertyExpressions)
            {
                _ = propertyExpression ?? throw new ArgumentNullException(nameof(propertyExpressions));

                var propertyName = ExpressionHelper.Property(propertyExpression);
                if (propertyName is not null)
                {
                    var memberInfo = TypeInfo.FindMember(propertyName);
                    if (memberInfo is not null)
                    {
                        var propertyBuilder = PropertyBuilder.PropertyBuilderFor<TPropertyType?, TClassType>(memberInfo);

                        Add(propertyBuilder);

                        propertyBuilderList.Add(propertyBuilder);
                    }
                    else
                    {
                        throw new InvalidOperationException($"Could not create PropertyBuilder for '{TypeInfo}'.{propertyName} ");
                    }
                }
                else
                {
                    throw new InvalidOperationException($"Could not create PropertyBuilder for '{TypeInfo}'.{propertyExpression} ");
                }
            }

            return new MultiplePropertyBuilder<TPropertyType?, TClassType>(propertyBuilderList);
        }
    }
}
