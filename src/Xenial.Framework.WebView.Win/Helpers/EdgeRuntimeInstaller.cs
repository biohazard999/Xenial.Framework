using System;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Threading.Tasks;

namespace Xenial.Framework.WebView.Win.Helpers
{
    /// <summary>
    /// Class EdgeRuntimeInstaller.
    /// </summary>
    /// <autogeneratedoc />
    public static class WebView2RuntimeInstaller
    {
        /// <summary>
        /// Gets the web view2 runtime installer URL.
        /// </summary>
        /// <value>The web view2 runtime installer URL.</value>
        /// <autogeneratedoc />
        public static readonly string WebView2RuntimeInstallerUrl = "https://go.microsoft.com/fwlink/p/?LinkId=2124703";

        /// <summary>
        /// Downloads the and install web view2 runtime.
        /// </summary>
        /// <returns><c>true</c> if XXXX, <c>false</c> otherwise.</returns>
        /// <autogeneratedoc />
        public static async Task<bool> DownloadAndInstallWebView2Runtime()
        {
            using var httpClient = new HttpClient();
            var installerTempPath = Path.GetTempFileName();
            var installerPath = $"{installerTempPath}.exe";
            File.Move(installerTempPath, installerPath);
            using (var installerStream = File.OpenWrite(installerPath))
            {
                await httpClient.DownloadFileAsync(WebView2RuntimeInstallerUrl, installerStream);
            }
            var proc = Process.Start(installerPath, "/install");
            proc.WaitForExit();
            return true;
        }
    }
}
