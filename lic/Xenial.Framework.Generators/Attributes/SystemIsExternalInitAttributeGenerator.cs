using System;

using Xenial.Framework.Generators.Base;
using Xenial.Framework.MsBuild;

namespace Xenial.Framework.Generators.Attributes;

public record SystemIsExternalInitAttributeGenerator(bool AddSources = true) : XenialAttributeGenerator(AddSources)
{
    public override string AttributeNamespace => "System.Runtime.CompilerServices";
    public override string AttributeName => "IsExternalInit";

    internal override CurlyIndenter CreateAttribute(CurlyIndenter syntaxWriter, string visibility)
    {
        _ = syntaxWriter ?? throw new ArgumentNullException(nameof(syntaxWriter));

        syntaxWriter.WriteLine("// <auto-generated />");
        syntaxWriter.WriteLine();
        syntaxWriter.WriteLine("#if !NET5_0_OR_GREATER");
        syntaxWriter.WriteLine("using System.ComponentModel;");

        using (syntaxWriter.OpenBrace("namespace System.Runtime.CompilerServices"))
        {
            syntaxWriter.WriteLine("[EditorBrowsable(EditorBrowsableState.Never)]");
            using (syntaxWriter.OpenBrace("internal static class IsExternalInit")) { }
        }

        syntaxWriter.WriteLine("#endif");

        return syntaxWriter;
    }
}
